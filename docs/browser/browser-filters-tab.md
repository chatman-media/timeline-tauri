# Документация по вкладке Фильтров (Filters Tab)

## Общее описание

Вкладка Фильтров является одной из вкладок компонента Browser в приложении Timeline Studio. Она предоставляет интерфейс для просмотра, поиска, фильтрации и выбора визуальных фильтров, которые можно применить к медиа-элементам на временной шкале проекта. Фильтры позволяют изменять цветовые и визуальные характеристики видео и изображений.

> **Примечание**: Вкладка фильтров реализована в коде, но может быть скрыта в текущем интерфейсе приложения.

## Структура файлов

```
src/features/browser/components/tabs/filters/
├── index.tsx                  # Экспорт компонентов вкладки
├── filter-list.tsx            # Основной компонент списка фильтров
├── filter-preview.tsx         # Компонент предпросмотра фильтра
├── filter-toolbar.tsx         # Панель инструментов для фильтров
└── filters.ts                 # Типы и утилиты для работы с фильтрами
```

## Хуки

### usePreviewSize (`preview-size-provider.tsx`)

Вкладка Фильтров использует общий хук `usePreviewSize` из директории `src/features/browser/components/preview/` для управления размером превью.

**Пример использования:**
```tsx
const {
  previewSize,
  increaseSize,
  decreaseSize,
  canIncreaseSize,
  canDecreaseSize,
} = usePreviewSize();
```

## Компоненты

### FilterList (`filter-list.tsx`)

Основной компонент для отображения списка фильтров.

**Пропсы:**
- Нет внешних пропсов, все данные получаются из контекста

**Состояние:**
- `filters` - список фильтров
- `searchQuery` - текущий поисковый запрос
- `showFavoritesOnly` - флаг отображения только избранных фильтров

**Функциональность:**
- Отображение списка доступных фильтров с превью
- Группировка фильтров по категориям
- Поиск фильтров по названию
- Фильтрация по избранным фильтрам
- Изменение размера превью
- Добавление фильтров на временную шкалу при клике

### FilterPreview (`filter-preview.tsx`)

Компонент для отображения превью фильтра.

**Пропсы:**
- `filter` - объект фильтра
- `size` - размер превью
- `onClick` - функция, вызываемая при клике на превью

**Функциональность:**
- Отображение превью фильтра (обычно в виде изображения с примененным фильтром)
- Отображение информации о фильтре (название, категория)
- Обработка клика для добавления фильтра на временную шкалу

### FilterToolbar (`filter-toolbar.tsx`)

Компонент панели инструментов для вкладки фильтров.

**Пропсы:**
- `searchQuery` - текущий поисковый запрос
- `onSearchChange` - функция изменения поискового запроса
- `showFavoritesOnly` - флаг отображения только избранных фильтров
- `onToggleFavorites` - функция переключения отображения избранных фильтров
- `canIncreaseSize` - можно ли увеличить размер превью
- `canDecreaseSize` - можно ли уменьшить размер превью
- `handleIncreaseSize` - функция увеличения размера превью
- `handleDecreaseSize` - функция уменьшения размера превью

**Функциональность:**
- Поле поиска фильтров
- Кнопка переключения отображения избранных фильтров
- Кнопки изменения размера превью

## Типы и интерфейсы

### Filter (`filters.ts`)

Интерфейс, описывающий фильтр.

```typescript
interface Filter {
  id: string;                // Уникальный идентификатор фильтра
  name: string;              // Название фильтра
  category: string;          // Категория фильтра
  previewUrl: string;        // URL превью фильтра
  isFavorite?: boolean;      // Флаг избранного фильтра
  description?: string;      // Описание фильтра
  tags?: string[];           // Теги фильтра для поиска
  parameters?: {             // Параметры фильтра, которые можно настраивать
    [key: string]: any;
  };
}
```

### FilterCategory (`filters.ts`)

Интерфейс, описывающий категорию фильтров.

```typescript
interface FilterCategory {
  id: string;                // Уникальный идентификатор категории
  name: string;              // Название категории
  description?: string;      // Описание категории
  filters: Filter[];         // Список фильтров в категории
}
```

## Интеграция с другими компонентами

### Интеграция с Preview Size

Вкладка Фильтров использует общий механизм управления размером превью, реализованный в виде хука `usePreviewSize` из директории `src/features/browser/components/preview/`.

### Интеграция с Timeline

Вкладка Фильтров интегрируется с компонентом Timeline для:
- Добавления выбранных фильтров к медиа-элементам на временной шкале
- Обновления параметров фильтров на временной шкале

## Особенности реализации

### Предпросмотр фильтров

Предпросмотр фильтров может быть реализован различными способами:
1. Статическое изображение с примененным фильтром
2. Интерактивный предпросмотр с использованием WebGL или Canvas для рендеринга фильтра в реальном времени

В текущей реализации используется подход со статическими изображениями для простоты и совместимости.

### Категории фильтров

Фильтры группируются по категориям для удобства навигации:
- Color (Цвет) - фильтры изменения цветовых характеристик
- Stylize (Стилизация) - фильтры художественной обработки
- Vintage (Винтаж) - фильтры с эффектом старых фотографий
- Black & White (Черно-белые) - фильтры монохромной обработки
- Cinematic (Кинематографические) - фильтры для создания киноэффектов
- и другие

## Примеры использования

### Инициализация вкладки Фильтров

```tsx
// В компоненте Browser
import { FilterList } from "./tabs/filters";

function Browser() {
  return (
    <div className="browser">
      <FilterList />
    </div>
  );
}
```

### Фильтрация фильтров

```tsx
// В компоненте FilterList
const [searchQuery, setSearchQuery] = useState("");
const [showFavoritesOnly, setShowFavoritesOnly] = useState(false);

// Фильтрация по поисковому запросу
const filteredFilters = filters.filter(filter => 
  filter.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
  filter.tags?.some(tag => tag.toLowerCase().includes(searchQuery.toLowerCase()))
);

// Фильтрация по избранным
const favoriteFilters = showFavoritesOnly 
  ? filteredFilters.filter(filter => filter.isFavorite)
  : filteredFilters;
```

### Изменение размера превью

```tsx
// В компоненте FilterToolbar
const { increaseSize, decreaseSize, canIncreaseSize, canDecreaseSize } = usePreviewSize();

// Увеличение размера превью
const handleZoomIn = () => {
  if (canIncreaseSize) {
    increaseSize();
  }
};

// Уменьшение размера превью
const handleZoomOut = () => {
  if (canDecreaseSize) {
    decreaseSize();
  }
};
```

## Тестирование

Для тестирования компонентов вкладки Фильтров используются следующие подходы:

1. **Модульные тесты** - для проверки отдельных компонентов и функций
2. **Интеграционные тесты** - для проверки взаимодействия компонентов
3. **Снимки (snapshots)** - для контроля визуального представления компонентов

Примеры тестов можно найти в файле `filter-list.test.tsx`.

## Примечания для разработчиков

- При добавлении новых фильтров убедитесь, что они имеют корректные превью и описания
- Для сложных фильтров рекомендуется создавать отдельные компоненты настройки параметров
- При работе с WebGL-фильтрами учитывайте производительность и совместимость с различными устройствами
