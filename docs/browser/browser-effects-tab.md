# Документация по вкладке Эффектов (Effects Tab)

## Общее описание

Вкладка Эффектов является одной из основных вкладок компонента Browser в приложении Timeline Studio. Она предоставляет интерфейс для просмотра, поиска, фильтрации и выбора визуальных эффектов, которые можно применить к медиа-элементам на временной шкале проекта. Эффекты позволяют изменять внешний вид и поведение видео, изображений и других элементов.

## Структура файлов

```
src/features/browser/components/tabs/effects/
├── index.tsx                  # Экспорт компонентов вкладки
├── effect-list.tsx            # Основной компонент списка эффектов
├── effect-preview.tsx         # Компонент предпросмотра эффекта
├── effect-toolbar.tsx         # Панель инструментов для эффектов
└── effects.ts                 # Типы и утилиты для работы с эффектами
```

## Хуки

### usePreviewSize (`preview-size-provider.tsx`)

Вкладка Эффектов использует общий хук `usePreviewSize` из директории `src/features/browser/components/preview/` для управления размером превью.

**Пример использования:**
```tsx
const {
  previewSize,
  increaseSize,
  decreaseSize,
  canIncreaseSize,
  canDecreaseSize,
} = usePreviewSize();
```

## Компоненты

### EffectList (`effect-list.tsx`)

Основной компонент для отображения списка эффектов.

**Пропсы:**
- Нет внешних пропсов, все данные получаются из контекста

**Состояние:**
- `effects` - список эффектов
- `searchQuery` - текущий поисковый запрос
- `showFavoritesOnly` - флаг отображения только избранных эффектов

**Функциональность:**
- Отображение списка эффектов с превью
- Группировка эффектов по категориям
- Поиск эффектов по названию
- Фильтрация по избранным эффектам
- Изменение размера превью
- Добавление эффектов на временную шкалу при клике

### EffectPreview (`effect-preview.tsx`)

Компонент для отображения превью эффекта.

**Пропсы:**
- `effect` - объект эффекта
- `size` - размер превью
- `onClick` - функция, вызываемая при клике на превью

**Функциональность:**
- Отображение превью эффекта (обычно в виде анимированного GIF или статического изображения)
- Отображение информации об эффекте (название, категория)
- Обработка клика для добавления эффекта на временную шкалу

### EffectToolbar (`effect-toolbar.tsx`)

Компонент панели инструментов для вкладки эффектов.

**Пропсы:**
- `searchQuery` - текущий поисковый запрос
- `onSearchChange` - функция изменения поискового запроса
- `showFavoritesOnly` - флаг отображения только избранных эффектов
- `onToggleFavorites` - функция переключения отображения избранных эффектов
- `canIncreaseSize` - можно ли увеличить размер превью
- `canDecreaseSize` - можно ли уменьшить размер превью
- `handleIncreaseSize` - функция увеличения размера превью
- `handleDecreaseSize` - функция уменьшения размера превью

**Функциональность:**
- Поле поиска эффектов
- Кнопка переключения отображения избранных эффектов
- Кнопки изменения размера превью

## Типы и интерфейсы

### Effect (`effects.ts`)

Интерфейс, описывающий эффект.

```typescript
interface Effect {
  id: string;                // Уникальный идентификатор эффекта
  name: string;              // Название эффекта
  category: string;          // Категория эффекта
  previewUrl: string;        // URL превью эффекта
  isFavorite?: boolean;      // Флаг избранного эффекта
  description?: string;      // Описание эффекта
  tags?: string[];           // Теги эффекта для поиска
  parameters?: {             // Параметры эффекта, которые можно настраивать
    [key: string]: any;
  };
}
```

### EffectCategory (`effects.ts`)

Интерфейс, описывающий категорию эффектов.

```typescript
interface EffectCategory {
  id: string;                // Уникальный идентификатор категории
  name: string;              // Название категории
  description?: string;      // Описание категории
  effects: Effect[];         // Список эффектов в категории
}
```

## Интеграция с другими компонентами

### Интеграция с Preview Size

Вкладка Эффектов использует общий механизм управления размером превью, реализованный в виде хука `usePreviewSize` из директории `src/features/browser/components/preview/`.

### Интеграция с Timeline

Вкладка Эффектов интегрируется с компонентом Timeline для:
- Добавления выбранных эффектов к медиа-элементам на временной шкале
- Обновления параметров эффектов на временной шкале

## Особенности реализации

### Предпросмотр эффектов

Предпросмотр эффектов может быть реализован различными способами:
1. Статическое изображение с визуализацией эффекта
2. Анимированный GIF, демонстрирующий эффект
3. Интерактивный предпросмотр с использованием WebGL или Canvas для рендеринга эффекта в реальном времени

В текущей реализации используется подход с анимированными GIF для простоты и совместимости.

### Категории эффектов

Эффекты группируются по категориям для удобства навигации:
- Transform (Трансформация) - эффекты изменения положения, размера и ориентации
- Color (Цвет) - эффекты изменения цветовых характеристик
- Blur & Sharpen (Размытие и резкость) - эффекты изменения четкости
- Distort (Искажение) - эффекты деформации изображения
- Stylize (Стилизация) - эффекты художественной обработки
- Text (Текст) - эффекты для работы с текстом
- Particle (Частицы) - эффекты с использованием систем частиц
- и другие

## Примеры использования

### Инициализация вкладки Эффектов

```tsx
// В компоненте Browser
import { EffectList } from "./tabs/effects";

function Browser() {
  return (
    <div className="browser">
      <EffectList />
    </div>
  );
}
```

### Фильтрация эффектов

```tsx
// В компоненте EffectList
const [searchQuery, setSearchQuery] = useState("");
const [showFavoritesOnly, setShowFavoritesOnly] = useState(false);

// Фильтрация по поисковому запросу
const filteredEffects = effects.filter(effect => 
  effect.name.toLowerCase().includes(searchQuery.toLowerCase()) ||
  effect.tags?.some(tag => tag.toLowerCase().includes(searchQuery.toLowerCase()))
);

// Фильтрация по избранным
const favoriteEffects = showFavoritesOnly 
  ? filteredEffects.filter(effect => effect.isFavorite)
  : filteredEffects;
```

### Изменение размера превью

```tsx
// В компоненте EffectToolbar
const { increaseSize, decreaseSize, canIncreaseSize, canDecreaseSize } = usePreviewSize();

// Увеличение размера превью
const handleZoomIn = () => {
  if (canIncreaseSize) {
    increaseSize();
  }
};

// Уменьшение размера превью
const handleZoomOut = () => {
  if (canDecreaseSize) {
    decreaseSize();
  }
};
```

## Расширение функциональности

### Добавление новой категории эффектов

1. Добавить новую категорию в список категорий в `effects.ts`
2. Создать эффекты для новой категории
3. Обновить компонент `effect-list.tsx` для отображения новой категории

### Добавление параметров настройки эффектов

1. Обновить интерфейс `Effect` в `effects.ts`, добавив новые параметры
2. Создать компонент для настройки параметров эффекта
3. Интегрировать компонент настройки с временной шкалой

### Реализация интерактивного предпросмотра

1. Создать компонент для интерактивного предпросмотра с использованием WebGL или Canvas
2. Обновить компонент `effect-preview.tsx` для использования интерактивного предпросмотра
3. Добавить логику для рендеринга эффекта в реальном времени

## Тестирование

Для тестирования компонентов вкладки Эффектов используются следующие подходы:

1. **Модульные тесты** - для проверки отдельных компонентов и функций
2. **Интеграционные тесты** - для проверки взаимодействия компонентов
3. **Снимки (snapshots)** - для контроля визуального представления компонентов

Примеры тестов можно найти в файле `effect-list.test.tsx`.

## Примечания для разработчиков

- При добавлении новых эффектов убедитесь, что они имеют корректные превью и описания
- Для сложных эффектов рекомендуется создавать отдельные компоненты настройки параметров
- При работе с WebGL-эффектами учитывайте производительность и совместимость с различными устройствами
