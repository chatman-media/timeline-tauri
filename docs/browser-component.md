# Документация по компоненту Browser

## Общее описание

Компонент Browser является одним из основных компонентов приложения Timeline Studio. Он предоставляет интерфейс для просмотра и выбора различных медиа-элементов, которые можно добавить на временную шкалу проекта.

Браузер состоит из нескольких вкладок, каждая из которых отвечает за определенный тип контента:
- Медиа (видео и изображения) - полностью функциональна, использует собственную машину состояний для размера превью
- Шаблоны - полностью функциональна, использует собственную машину состояний с минимальным размером превью 125px
- Переходы - полностью функциональна, использует общий хук usePreviewSize
- Эффекты - полностью функциональна, использует общий хук usePreviewSize
- Музыка - полностью функциональна, не имеет функционала изменения размера превью
- Фильтры - реализована в коде, но может быть скрыта в текущем интерфейсе, использует общий хук usePreviewSize
- Субтитры - в процессе разработки (TODO)

## Структура файлов

```
src/features/browser/
├── components/
│   ├── browser.tsx                # Основной компонент браузера
│   ├── browser-tabs.tsx           # Компонент с табами браузера
│   ├── preview/                   # Компоненты для предпросмотра
│   │   ├── preview-size-machine.ts        # Машина состояний для размера превью
│   │   ├── preview-size-provider.tsx      # Провайдер контекста размера превью
│   │   └── preview-size.tsx               # Компонент управления размером превью
│   ├── tabs/                      # Компоненты для каждой вкладки
│   │   ├── media/                 # Вкладка медиа (видео и изображения)
│   │   ├── templates/             # Вкладка шаблонов
│   │   ├── transitions/           # Вкладка переходов
│   │   ├── effects/               # Вкладка эффектов
│   │   ├── filters/               # Вкладка фильтров
│   │   ├── music/                 # Вкладка музыки
│   │   └── subtitles/             # Вкладка субтитров
│   └── toolbar/                   # Компоненты панели инструментов
├── media/                         # Сервисы для работы с медиа
└── services/                      # Сервисы браузера
```

## Основные компоненты

### Browser (`browser.tsx`)

Основной компонент, который объединяет все вкладки и управляет их отображением.

**Основные функции:**
- Отображение вкладок браузера
- Переключение между вкладками
- Отображение содержимого активной вкладки

**Используемые провайдеры:**
- `MediaListProvider` - для работы с медиа-файлами
- `PreviewSizeProvider` - для управления размером превью

### Вкладки браузера

## 1. Вкладка Медиа (Media)

### Файлы
- `src/features/browser/components/tabs/media/media-list.tsx` - основной компонент списка медиа
- `src/features/browser/components/tabs/media/media-list-provider.tsx` - провайдер контекста списка медиа
- `src/features/browser/components/tabs/media/media-list-machine.ts` - машина состояний для списка медиа
- `src/features/browser/components/tabs/media/media-preview.tsx` - компонент предпросмотра медиа
- `src/features/browser/components/tabs/media/media-toolbar.tsx` - панель инструментов для медиа

### Машины состояний
- `mediaListMachine` - управляет состоянием списка медиа, включая фильтрацию, сортировку и размер превью

### Провайдеры
- `MediaListProvider` - предоставляет контекст для работы со списком медиа

### Хуки
- `useMediaList` - хук для доступа к контексту списка медиа

### Особенности
- **Собственная машина состояний для размера превью**: Вкладка использует свою собственную машину состояний для управления размером превью, независимую от других вкладок
- **Собственные настройки размера превью**: Имеет свои минимальные и максимальные значения размера превью, а также свой набор доступных размеров

### Функциональность
- Отображение списка доступных медиа-файлов (видео и изображений)
- Фильтрация медиа по типу (видео/изображения)
- Поиск медиа по имени файла
- Изменение размера превью
- Добавление медиа на временную шкалу
- Загрузка новых медиа-файлов

## 2. Вкладка Шаблонов (Templates)

### Файлы
- `src/features/browser/components/tabs/templates/template-list.tsx` - основной компонент списка шаблонов
- `src/features/browser/components/tabs/templates/template-list-provider.tsx` - провайдер контекста списка шаблонов
- `src/features/browser/components/tabs/templates/template-list-machine.ts` - машина состояний для списка шаблонов
- `src/features/browser/components/tabs/templates/template-preview.tsx` - компонент предпросмотра шаблона
- `src/features/browser/components/tabs/templates/template-labels.tsx` - компонент для отображения меток шаблонов
- `src/features/browser/components/tabs/templates/templates.ts` - типы и утилиты для работы с шаблонами

### Машины состояний
- `templateListMachine` - управляет состоянием списка шаблонов, включая фильтрацию, избранное и размер превью

### Провайдеры
- `TemplateListProvider` - предоставляет контекст для работы со списком шаблонов

### Хуки
- `useTemplateList` - хук для доступа к контексту списка шаблонов

### Особенности
- **Собственная машина состояний для размера превью**: Вкладка использует свою собственную машину состояний для управления размером превью, независимую от других вкладок
- **Минимальный размер превью 125px**: В отличие от других вкладок, минимальный размер превью для шаблонов начинается с 125px
- **Собственный набор размеров превью**: Использует свой массив `TEMPLATE_PREVIEW_SIZES` для определения доступных размеров превью

### Функциональность
- Отображение списка доступных шаблонов
- Группировка шаблонов по категориям (горизонтальные, вертикальные, квадратные)
- Поиск шаблонов по названию
- Фильтрация по избранным шаблонам
- Изменение размера превью (начиная с 125px)
- Добавление шаблонов на временную шкалу

## 3. Вкладка Переходов (Transitions)

### Файлы
- `src/features/browser/components/tabs/transitions/transition-list.tsx` - основной компонент списка переходов
- `src/features/browser/components/tabs/transitions/transition-preview.tsx` - компонент предпросмотра перехода
- `src/features/browser/components/tabs/transitions/transitions.ts` - типы и утилиты для работы с переходами

### Хуки
- `usePreviewSize` - хук для управления размером превью переходов

### Особенности
- **Использование общего хука usePreviewSize**: Вкладка использует общий хук `usePreviewSize` из директории `preview/` для управления размером превью
- **Общие настройки размера превью**: Использует общие настройки минимального и максимального размера превью, а также общий набор доступных размеров

### Функциональность
- Отображение списка доступных переходов
- Группировка переходов по категориям
- Поиск переходов по названию
- Фильтрация по избранным переходам
- Изменение размера превью
- Добавление переходов на временную шкалу

## 4. Вкладка Эффектов (Effects)

### Файлы
- `src/features/browser/components/tabs/effects/effect-list.tsx` - основной компонент списка эффектов
- `src/features/browser/components/tabs/effects/effect-preview.tsx` - компонент предпросмотра эффекта
- `src/features/browser/components/tabs/effects/effects.ts` - типы и утилиты для работы с эффектами

### Хуки
- `usePreviewSize` - хук для управления размером превью эффектов

### Особенности
- **Использование общего хука usePreviewSize**: Вкладка использует общий хук `usePreviewSize` из директории `preview/` для управления размером превью
- **Общие настройки размера превью**: Использует общие настройки минимального и максимального размера превью, а также общий набор доступных размеров

### Функциональность
- Отображение списка доступных эффектов
- Группировка эффектов по категориям
- Поиск эффектов по названию
- Фильтрация по избранным эффектам
- Изменение размера превью
- Добавление эффектов на временную шкалу

## 5. Вкладка Фильтров (Filters)

> **Примечание**: Вкладка фильтров реализована в коде, но может быть скрыта в текущем интерфейсе приложения.
> Подробная документация доступна в файле [browser-filters-tab.md](./browser-filters-tab.md).

### Файлы
- `src/features/browser/components/tabs/filters/filter-list.tsx` - основной компонент списка фильтров
- `src/features/browser/components/tabs/filters/filter-preview.tsx` - компонент предпросмотра фильтра
- `src/features/browser/components/tabs/filters/filters.ts` - типы и утилиты для работы с фильтрами

### Хуки
- `usePreviewSize` - хук для управления размером превью фильтров

### Особенности
- **Может быть скрыта в интерфейсе**: Вкладка фильтров реализована в коде, но может быть скрыта в текущем интерфейсе
- **Использование общего хука usePreviewSize**: Вкладка использует общий хук `usePreviewSize` из директории `preview/` для управления размером превью
- **Общие настройки размера превью**: Использует общие настройки минимального и максимального размера превью, а также общий набор доступных размеров

### Функциональность
- Отображение списка доступных фильтров
- Группировка фильтров по категориям
- Поиск фильтров по названию
- Фильтрация по избранным фильтрам
- Изменение размера превью
- Добавление фильтров на временную шкалу

## 6. Вкладка Музыки (Music)

### Файлы
- `src/features/browser/components/tabs/music/music-list.tsx` - основной компонент списка музыки
- `src/features/browser/components/tabs/music/music-preview.tsx` - компонент предпросмотра музыки
- `src/features/browser/components/tabs/music/music.ts` - типы и утилиты для работы с музыкой

### Особенности
- **Отсутствие управления размером превью**: В отличие от других вкладок, вкладка музыки не имеет функционала изменения размера превью, так как для аудио-файлов это не требуется
- **Фиксированный размер элементов**: Все элементы списка музыки имеют фиксированный размер
- **Фокус на аудио-контроле**: Вместо управления размером превью, вкладка фокусируется на элементах управления воспроизведением аудио

### Функциональность
- Отображение списка доступных аудио-файлов
- Поиск музыки по названию
- Предпрослушивание аудио-файлов
- Добавление музыки на временную шкалу

## 7. Вкладка Субтитров (Subtitles)

> **Примечание**: Вкладка субтитров находится в процессе разработки (TODO) и может быть не полностью функциональна в текущей версии приложения.
> Подробная документация доступна в файле [browser-subtitles-tab.md](./browser-subtitles-tab.md).

### Файлы
- `src/features/browser/components/tabs/subtitles/subtitles-list.tsx` - основной компонент списка субтитров
- `src/features/browser/components/tabs/subtitles/subtitles-preview.tsx` - компонент предпросмотра субтитров
- `src/features/browser/components/tabs/subtitles/subtitles.ts` - типы и утилиты для работы с субтитрами

### Хуки
- `usePreviewSize` - хук для управления размером превью субтитров

### Особенности
- **В разработке (TODO)**: Функциональность вкладки субтитров находится в процессе разработки
- **Использование общего хука usePreviewSize**: Вкладка использует общий хук `usePreviewSize` из директории `preview/` для управления размером превью
- **Общие настройки размера превью**: Использует общие настройки минимального и максимального размера превью, а также общий набор доступных размеров

### Планируемая функциональность
- Отображение списка доступных стилей субтитров
- Предпросмотр стилей субтитров
- Изменение размера превью
- Добавление субтитров на временную шкалу
- Редактирование текста субтитров
- Настройка времени отображения субтитров

## Общие компоненты для вкладок

### Preview Size (`preview/`)

#### Файлы
- `preview-size-machine.ts` - машина состояний для управления размером превью
- `preview-size-provider.tsx` - провайдер контекста размера превью
- `preview-size.tsx` - компонент и хуки для работы с размером превью

#### Машины состояний
- `previewSizeMachine` - управляет состоянием размера превью, включая увеличение/уменьшение и сохранение в localStorage

#### Провайдеры
- `PreviewSizeProvider` - предоставляет контекст для работы с размером превью

#### Хуки
- `usePreviewSize` - хук для доступа к контексту размера превью

#### Функциональность
- Управление размером превью для всех типов контента
- Сохранение выбранного размера в localStorage
- Ограничение минимального и максимального размера превью

## Интеграция с другими компонентами

Браузер интегрируется с другими компонентами приложения:

1. **Timeline** - элементы, выбранные в браузере, добавляются на временную шкалу
2. **Project Settings** - настройки проекта влияют на отображение шаблонов и других элементов
3. **Media Services** - сервисы для работы с медиа-файлами используются для загрузки и обработки контента

## Расширение функциональности

Для добавления новой вкладки в браузер необходимо:

1. Создать компоненты для новой вкладки в директории `src/features/browser/components/tabs/`
2. При необходимости создать машину состояний и провайдер для новой вкладки
3. Добавить новую вкладку в компонент `browser.tsx`
4. Обновить типы и константы в соответствующих файлах

## Примечания для разработчиков

- Каждая вкладка должна поддерживать единый интерфейс для интеграции с основным компонентом браузера
- Для управления размером превью рекомендуется использовать общий хук `usePreviewSize` или создать собственную машину состояний по аналогии с `template-list-machine.ts`
- При работе с медиа-файлами используйте сервисы из директории `src/features/browser/media/`
