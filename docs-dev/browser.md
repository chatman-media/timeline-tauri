## Browser (Браузер медиафайлов)

**Состояние:** Управляется через `mediaMachine`

- Добавление файлов
- Отображение файлов
- Управление вкладками (Медиатека, Музыка, Переходы, Эффекты, Фильтры, Стикеры, Шаблоны)
- Навигация по медиатеке
- Просмотр видео и прослушивание аудио
- Сортировка, фильтрация, группировка
- Отображение метаданных файлов
- Добавление файлов на таймлайн
- Запись с камеры, экрана ПК и голоса

**Компоненты:**

- `browser/components/` - основные компоненты браузера
  - `browser.tsx` - корневой компонент
  - `layout/` - компоненты макета
    - `add-media-button.tsx` - кнопка добавления медиа
    - `audio-player.tsx` - аудиоплеер
    - `no-files.tsx` - компонент для отображения пустого состояния
    - `status-bar.tsx` - статусная строка
  - `preview/` - компоненты предпросмотра
    - `media-preview.tsx` - общий компонент предпросмотра
    - `video-preview.tsx` - предпросмотр видео
    - `audio-preview.tsx` - предпросмотр аудио
    - `image-preview.tsx` - предпросмотр изображений
    - `preview-timeline.tsx` - временная шкала для предпросмотра
  - `tabs/` - компоненты вкладок
    - `media/` - вкладка медиатеки
      - `media-list.tsx` - список медиафайлов
      - `file-metadata.tsx` - метаданные файла
      - `media-toolbar.tsx` - панель инструментов медиатеки
    - `music/` - вкладка музыки
      - `music-file-list.tsx` - список аудиофайлов
      - `music-toolbar.tsx` - панель инструментов музыки
    - `transitions/` - вкладка переходов
      - `transition-list.tsx` - список переходов
    - `effects/` - вкладка эффектов
      - `effect-list.tsx` - список эффектов
    - `filters/` - вкладка фильтров
      - `filter-list.tsx` - список фильтров
    - `stickers/` - вкладка стикеров
      - `sticker-list.tsx` - список стикеров
    - `subtitles/` - вкладка субтитров
      - `subtitle-list.tsx` - список субтитров
    - `templates/` - вкладка шаблонов
      - `template-list.tsx` - список шаблонов
      - `template-list-toolbar.tsx` - панель инструментов шаблонов

**Дополнительные компоненты:**

- `dialogs/components/` - компоненты диалогов
  - `camera-recording.tsx` - запись с камеры

**Файлы состояния:**

- `browser/machines/` - машины состояний
  - `media-machine.ts` - машина состояний для медиафайлов
  - `user-settings-machine.ts` - машина состояний для пользовательских настроек
- `browser/providers/` - провайдеры контекста
  - `media-provider.tsx` - провайдер контекста медиафайлов
  - `user-settings-provider.tsx` - провайдер контекста пользовательских настроек
- `browser/contexts/` - контексты
  - `use-media.ts` - хук для доступа к контексту медиафайлов

**Описание машины состояний:**
`mediaMachine` управляет состоянием медиафайлов в приложении. Она отвечает за загрузку, отображение и управление файлами, включая их добавление в проект, фильтрацию и предпросмотр. Машина также контролирует состояние загрузки и доступность файлов.

**TODO:**

- Реализовать запись экрана ПК (создать компонент `screen-recording.tsx`)
- Реализовать запись голоса (создать компонент `audio-recording.tsx`)
- Проработать механизм добавления/переноса эффектов, фильтров и переходов на таймлайн
- Разработать систему добавления шаблонов на объединенный схема-таймлайн (когда он будет реализован)
- Реализовать синхронизацию настроек предпросмотра (размеры, переходы, фильтры, эффекты) между вкладками
- Добавить возможность группировки шаблонов по количеству экранов

**Задачи по оптимизации компонентов:**

1. **Создать общий шаблон для компонентов вкладок (BrowserTabTemplate)** - базовый компонент, который будет содержать общую логику для всех вкладок

   - Вынести общую структуру компонентов вкладок в базовый компонент
   - Реализовать общие методы для фильтрации, сортировки и группировки
   - Добавить типизацию для различных типов элементов (медиафайлы, шаблоны, эффекты и т.д.)

2. **Создать общий компонент для панелей инструментов (BrowserToolbar)** - унифицированный компонент для всех панелей инструментов

   - Вынести общие элементы управления (поиск, изменение размера превью)
   - Реализовать возможность расширения через слоты или пропсы
   - Унифицировать стили и поведение

3. **Унифицировать управление размером превью** - улучшить существующий хук usePreviewSize

   - Добавить возможность указывать минимальный и максимальный размеры для каждого типа вкладки
   - Реализовать сохранение настроек в едином формате
   - Добавить возможность синхронизации размеров между вкладками

4. **Оптимизировать работу с localStorage** - создать общий сервис для работы с localStorage

   - Реализовать кэширование данных
   - Добавить обработку ошибок
   - Унифицировать формат хранения данных

5. **Улучшить типизацию** - добавить более строгую типизацию для всех компонентов

   - Создать общие интерфейсы для элементов разных типов
   - Добавить типизацию для пропсов компонентов
   - Улучшить типизацию для машин состояний

6. **Создать общие компоненты для отображения элементов** - унифицировать отображение элементов в разных режимах просмотра

   - Реализовать общие компоненты для отображения элементов в режимах список, сетка и миниатюры
   - Добавить возможность кастомизации через пропсы
   - Унифицировать стили и поведение

7. **Рефакторинг существующих компонентов** - применить новые общие компоненты к существующим вкладкам
   - Переписать компоненты вкладок с использованием общего шаблона
   - Переписать панели инструментов с использованием общего компонента
   - Оптимизировать рендеринг с использованием memo, useCallback и useMemo

**Интерактивное управление воспроизведением:**

1. **Автоматическое воспроизведение при наведении**

   - При наведении курсора на миниатюру показывается временная шкала
   - Видео/аудио автоматически перематывается на позицию курсора
   - Поддерживается множественный предпросмотр для файлов с несколькими потоками

2. **Управление по клику**

   - Клик на миниатюру запускает воспроизведение
   - Повторный клик останавливает воспроизведение
   - При воспроизведении одного файла, другие автоматически останавливаются
   - Воспроизведение начинается с позиции предпросмотра, если она активна

3. **Автоматическая остановка**
   - При уходе курсора с миниатюры воспроизведение автоматически останавливается
   - Временная шкала и индикаторы скрываются
   - Состояние воспроизведения сбрасывается

**Режимы отображения:**

1. **Список (List)**

   - Компактное отображение файлов
   - Показывает миниатюру и метаданные
   - Оптимизирован для быстрого поиска

2. **Сетка (Grid)**

   - Отображение файлов в виде сетки
   - Увеличенные миниатюры
   - Подходит для визуального поиска

3. **Миниатюры (Thumbnails)**
   - Горизонтальное отображение с увеличенными превью
   - Показывает название файла
   - Удобен для работы с видео

**Сортировка, фильтрация и группировка:**

1. **Сортировка**

   - По имени (A-Z, Z-A)
   - По дате создания (новые-старые, старые-новые)
   - По размеру файла
   - По длительности

2. **Фильтрация**

   - Все файлы
   - Видео
   - Аудио
   - Изображения

3. **Группировка**

   - Без группировки
   - По типу файла (видео/аудио/изображения)
   - По дате создания
   - По длительности

4. **Поиск**

   - Поиск по имени файла
   - Поиск по тегам
   - Поиск по метаданным
   - Фильтрация результатов поиска
   - Сохранение поисковых запросов
   - Быстрый поиск (по мере ввода)

5. **Управление метаданными**
   - Просмотр метаданных файла
   - Редактирование тегов
   - Добавление описаний
   - Управление рейтингами
   - Добавление заметок
   - Экспорт метаданных

**Контекст mediaMachine:**

- `allMediaFiles: MediaFile[]` - все доступные медиафайлы
- `includedFiles: MediaFile[]` - файлы, включенные в проект
- `includedFilePaths: string[]` - пути к включенным файлам
- `unavailableFiles: MediaFile[]` - недоступные файлы
- `isLoading: boolean` - состояние загрузки

**Методы mediaMachine:**

- `setLoading` - установка состояния загрузки
- `setAllMediaFiles` - установка всех медиафайлов
- `addMediaFiles` - добавление новых медиафайлов
- `removeMediaFiles` - удаление медиафайлов
- `setIncludedFiles` - установка включенных в проект файлов
- `includeFiles` - включение файлов в проект
- `unincludeFiles` - исключение файлов из проекта
- `setUnavailableFiles` - установка недоступных файлов
