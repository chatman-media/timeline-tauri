# Документация по вкладке Шаблонов (Templates Tab)

## Общее описание

Вкладка Шаблонов является одной из основных вкладок компонента Browser в приложении Timeline Studio. Она предоставляет интерфейс для просмотра, поиска, фильтрации и выбора шаблонов, которые можно добавить на временную шкалу проекта. Шаблоны представляют собой готовые композиции, которые могут включать в себя текст, анимации и другие элементы.

## Структура файлов

```
src/features/browser/components/tabs/templates/
├── index.tsx                  # Экспорт компонентов вкладки
├── template-list.tsx          # Основной компонент списка шаблонов
├── template-list-provider.tsx # Провайдер контекста списка шаблонов
├── template-list-machine.ts   # Машина состояний для списка шаблонов
├── template-preview.tsx       # Компонент предпросмотра шаблона
├── template-labels.tsx        # Компонент для отображения меток шаблонов
└── templates.ts               # Типы и утилиты для работы с шаблонами
```

## Машины состояний

### TemplateListMachine (`template-list-machine.ts`)

Машина состояний для управления списком шаблонов, реализованная с использованием библиотеки XState.

**Состояния:**
- `idle` - состояние ожидания действий пользователя

**События:**
- `INCREASE_PREVIEW_SIZE` - увеличение размера превью
- `DECREASE_PREVIEW_SIZE` - уменьшение размера превью
- `SET_PREVIEW_SIZE` - установка конкретного размера превью
- `SET_SEARCH_QUERY` - установка поискового запроса
- `TOGGLE_FAVORITES` - переключение отображения избранных шаблонов
- `SET_SHOW_FAVORITES_ONLY` - установка отображения только избранных шаблонов

**Контекст:**
- `previewSize` - текущий размер превью
- `canIncreaseSize` - можно ли увеличить размер превью
- `canDecreaseSize` - можно ли уменьшить размер превью
- `searchQuery` - текущий поисковый запрос
- `showFavoritesOnly` - флаг отображения только избранных шаблонов

**Константы:**
- `TEMPLATE_PREVIEW_SIZES` - массив доступных размеров превью, начиная с 125px
- `MIN_TEMPLATE_PREVIEW_SIZE` - минимальный размер превью (125px)
- `MAX_TEMPLATE_PREVIEW_SIZE` - максимальный размер превью
- `DEFAULT_TEMPLATE_PREVIEW_SIZE` - размер превью по умолчанию
- `TEMPLATE_STORAGE_KEY` - ключ для сохранения размера превью в localStorage

**Функции:**
- `getSavedTemplateSize()` - получение сохраненного размера превью из localStorage
- `saveTemplateSize(size)` - сохранение размера превью в localStorage
- `getSavedFavoritesState()` - получение сохраненного состояния избранных из localStorage
- `saveFavoritesState(value)` - сохранение состояния избранных в localStorage

## Провайдеры

### TemplateListProvider (`template-list-provider.tsx`)

Провайдер контекста для списка шаблонов, использующий машину состояний `templateListMachine`.

**Контекст:**
- `previewSize` - текущий размер превью
- `canIncreaseSize` - можно ли увеличить размер превью
- `canDecreaseSize` - можно ли уменьшить размер превью
- `searchQuery` - текущий поисковый запрос
- `showFavoritesOnly` - флаг отображения только избранных шаблонов
- `increaseSize()` - функция увеличения размера превью
- `decreaseSize()` - функция уменьшения размера превью
- `setPreviewSize(size)` - функция установки конкретного размера превью
- `setSearchQuery(query)` - функция установки поискового запроса
- `toggleFavorites()` - функция переключения отображения избранных шаблонов
- `setShowFavoritesOnly(value)` - функция установки отображения только избранных шаблонов

## Хуки

### useTemplateList (`template-list-provider.tsx`)

Хук для доступа к контексту списка шаблонов.

**Пример использования:**
```tsx
const {
  previewSize,
  increaseSize,
  decreaseSize,
  canIncreaseSize,
  canDecreaseSize,
  searchQuery,
  setSearchQuery,
  showFavoritesOnly,
  toggleFavorites,
} = useTemplateList();
```

## Компоненты

### TemplateList (`template-list.tsx`)

Основной компонент для отображения списка шаблонов.

**Пропсы:**
- Нет внешних пропсов, все данные получаются из контекста

**Состояние:**
- `templates` - список шаблонов
- `currentDimensions` - текущие размеры шаблонов (ширина и высота)
- `currentGroup` - текущая группа шаблонов (landscape, portrait, square)

**Функциональность:**
- Отображение списка шаблонов с превью
- Группировка шаблонов по соотношению сторон (горизонтальные, вертикальные, квадратные)
- Поиск шаблонов по названию
- Фильтрация по избранным шаблонам
- Изменение размера превью
- Добавление шаблонов на временную шкалу при клике

### TemplatePreview (`template-preview.tsx`)

Компонент для отображения превью шаблона.

**Пропсы:**
- `template` - объект шаблона
- `size` - размер превью
- `onClick` - функция, вызываемая при клике на превью

**Функциональность:**
- Отображение превью шаблона
- Отображение информации о шаблоне (название, категория)
- Обработка клика для добавления шаблона на временную шкалу

### TemplateLabels (`template-labels.tsx`)

Компонент для отображения меток шаблонов.

**Пропсы:**
- `template` - объект шаблона
- `size` - размер меток

**Функциональность:**
- Отображение названия шаблона
- Отображение категории шаблона
- Отображение иконок для дополнительной информации о шаблоне

## Интеграция с другими компонентами

### Интеграция с Project Settings

Вкладка Шаблонов интегрируется с настройками проекта для:
- Получения текущего соотношения сторон проекта
- Фильтрации шаблонов, соответствующих текущему соотношению сторон
- Адаптации размеров шаблонов под текущие настройки проекта

### Интеграция с Media Services

Вкладка Шаблонов использует сервисы из директории `src/features/browser/media/` для:
- Загрузки списка доступных шаблонов
- Получения метаданных шаблонов
- Добавления шаблонов на временную шкалу

## Особенности реализации

### Отдельная машина состояний

В отличие от других вкладок, вкладка Шаблонов использует собственную машину состояний `templateListMachine` вместо общего хука `usePreviewSize`. Это сделано для того, чтобы:

1. Использовать отдельный набор размеров превью, начиная с 125px
2. Иметь независимое управление размером превью для шаблонов
3. Сохранять настройки размера превью для шаблонов отдельно от других вкладок

### Группировка шаблонов

Шаблоны группируются по соотношению сторон:
- Горизонтальные (landscape) - шаблоны с соотношением сторон 16:9, 21:9 и т.д.
- Вертикальные (portrait) - шаблоны с соотношением сторон 9:16, 3:4 и т.д.
- Квадратные (square) - шаблоны с соотношением сторон 1:1

Это позволяет пользователю быстро находить шаблоны, подходящие для конкретного типа проекта.

## Примеры использования

### Инициализация вкладки Шаблонов

```tsx
// В компоненте Browser
import { TemplatesTab } from "./tabs/templates";

function Browser() {
  return (
    <div className="browser">
      <TemplatesTab />
    </div>
  );
}
```

### Фильтрация шаблонов

```tsx
// В компоненте TemplateList
const { searchQuery, setSearchQuery, showFavoritesOnly, toggleFavorites } = useTemplateList();

// Фильтрация по поисковому запросу
const filteredTemplates = templates.filter(template => 
  template.name.toLowerCase().includes(searchQuery.toLowerCase())
);

// Фильтрация по избранным
const favoriteTemplates = showFavoritesOnly 
  ? filteredTemplates.filter(template => template.isFavorite)
  : filteredTemplates;
```

### Изменение размера превью

```tsx
// В компоненте TemplateToolbar
const { increaseSize, decreaseSize, canIncreaseSize, canDecreaseSize } = useTemplateList();

// Увеличение размера превью
const handleZoomIn = () => {
  if (canIncreaseSize) {
    increaseSize();
  }
};

// Уменьшение размера превью
const handleZoomOut = () => {
  if (canDecreaseSize) {
    decreaseSize();
  }
};
```

## Расширение функциональности

### Добавление новой группы шаблонов

1. Добавить новый тип группы в `template-list.tsx`
2. Обновить логику группировки шаблонов
3. Добавить новый таб для группы в интерфейсе

### Добавление новых метаданных шаблонов

1. Обновить типы в `templates.ts`
2. Обновить компонент `template-preview.tsx` для отображения новых метаданных
3. Обновить компонент `template-labels.tsx` для отображения новых меток

### Добавление новых размеров превью

1. Обновить массив `TEMPLATE_PREVIEW_SIZES` в `template-list-machine.ts`
2. При необходимости обновить константы `MIN_TEMPLATE_PREVIEW_SIZE` и `MAX_TEMPLATE_PREVIEW_SIZE`
