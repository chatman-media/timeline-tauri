# Документация по вкладке Медиа (Media Tab)

## Общее описание

Вкладка Медиа является одной из основных вкладок компонента Browser в приложении Timeline Studio. Она предоставляет интерфейс для просмотра, поиска, фильтрации и выбора медиа-файлов (видео и изображений), которые можно добавить на временную шкалу проекта.

## Структура файлов

```
src/features/browser/components/tabs/media/
├── index.tsx                  # Экспорт компонентов вкладки
├── media-list.tsx             # Основной компонент списка медиа
├── media-list-provider.tsx    # Провайдер контекста списка медиа
├── media-list-machine.ts      # Машина состояний для списка медиа
├── media-preview.tsx          # Компонент предпросмотра медиа
├── media-toolbar.tsx          # Панель инструментов для медиа
└── media-types.ts             # Типы и интерфейсы для медиа
```

## Машины состояний

### MediaListMachine (`media-list-machine.ts`)

Машина состояний для управления списком медиа-файлов, реализованная с использованием библиотеки XState.

**Состояния:**
- `idle` - состояние ожидания действий пользователя

**События:**
- `INCREASE_PREVIEW_SIZE` - увеличение размера превью
- `DECREASE_PREVIEW_SIZE` - уменьшение размера превью
- `SET_PREVIEW_SIZE` - установка конкретного размера превью
- `SET_SEARCH_QUERY` - установка поискового запроса
- `SET_MEDIA_TYPE_FILTER` - установка фильтра по типу медиа (видео/изображения)
- `TOGGLE_FAVORITES` - переключение отображения избранных медиа
- `SET_SHOW_FAVORITES_ONLY` - установка отображения только избранных медиа

**Контекст:**
- `previewSize` - текущий размер превью
- `canIncreaseSize` - можно ли увеличить размер превью
- `canDecreaseSize` - можно ли уменьшить размер превью
- `searchQuery` - текущий поисковый запрос
- `mediaTypeFilter` - текущий фильтр по типу медиа
- `showFavoritesOnly` - флаг отображения только избранных медиа

**Константы:**
- `MEDIA_PREVIEW_SIZES` - массив доступных размеров превью
- `MIN_MEDIA_PREVIEW_SIZE` - минимальный размер превью
- `MAX_MEDIA_PREVIEW_SIZE` - максимальный размер превью
- `DEFAULT_MEDIA_PREVIEW_SIZE` - размер превью по умолчанию
- `MEDIA_STORAGE_KEY` - ключ для сохранения размера превью в localStorage

**Функции:**
- `getSavedMediaSize()` - получение сохраненного размера превью из localStorage
- `saveMediaSize(size)` - сохранение размера превью в localStorage
- `getSavedMediaFavoritesState()` - получение сохраненного состояния избранных из localStorage
- `saveMediaFavoritesState(value)` - сохранение состояния избранных в localStorage

## Провайдеры

### MediaListProvider (`media-list-provider.tsx`)

Провайдер контекста для списка медиа-файлов, использующий машину состояний `mediaListMachine`.

**Контекст:**
- `previewSize` - текущий размер превью
- `canIncreaseSize` - можно ли увеличить размер превью
- `canDecreaseSize` - можно ли уменьшить размер превью
- `searchQuery` - текущий поисковый запрос
- `mediaTypeFilter` - текущий фильтр по типу медиа
- `showFavoritesOnly` - флаг отображения только избранных медиа
- `increaseSize()` - функция увеличения размера превью
- `decreaseSize()` - функция уменьшения размера превью
- `setPreviewSize(size)` - функция установки конкретного размера превью
- `setSearchQuery(query)` - функция установки поискового запроса
- `setMediaTypeFilter(filter)` - функция установки фильтра по типу медиа
- `toggleFavorites()` - функция переключения отображения избранных медиа
- `setShowFavoritesOnly(value)` - функция установки отображения только избранных медиа

## Хуки

### useMediaList (`media-list-provider.tsx`)

Хук для доступа к контексту списка медиа-файлов.

**Пример использования:**
```tsx
const {
  previewSize,
  increaseSize,
  decreaseSize,
  canIncreaseSize,
  canDecreaseSize,
  searchQuery,
  setSearchQuery,
  mediaTypeFilter,
  setMediaTypeFilter,
  showFavoritesOnly,
  toggleFavorites,
} = useMediaList();
```

## Компоненты

### MediaList (`media-list.tsx`)

Основной компонент для отображения списка медиа-файлов.

**Пропсы:**
- Нет внешних пропсов, все данные получаются из контекста

**Состояние:**
- `mediaFiles` - список медиа-файлов
- `filteredMediaFiles` - отфильтрованный список медиа-файлов
- `isLoading` - флаг загрузки медиа-файлов

**Функциональность:**
- Отображение списка медиа-файлов с превью
- Фильтрация медиа-файлов по типу (видео/изображения)
- Поиск медиа-файлов по имени
- Фильтрация по избранным медиа-файлам
- Изменение размера превью
- Добавление медиа-файлов на временную шкалу при клике

### MediaPreview (`media-preview.tsx`)

Компонент для отображения превью медиа-файла.

**Пропсы:**
- `media` - объект медиа-файла
- `size` - размер превью
- `onClick` - функция, вызываемая при клике на превью

**Функциональность:**
- Отображение превью изображения или видео
- Отображение информации о медиа-файле (название, длительность, разрешение)
- Отображение иконки типа медиа-файла (видео/изображение)
- Обработка клика для добавления медиа-файла на временную шкалу

### MediaToolbar (`media-toolbar.tsx`)

Компонент панели инструментов для вкладки медиа.

**Пропсы:**
- `searchQuery` - текущий поисковый запрос
- `onSearchChange` - функция изменения поискового запроса
- `mediaTypeFilter` - текущий фильтр по типу медиа
- `onMediaTypeFilterChange` - функция изменения фильтра по типу медиа
- `showFavoritesOnly` - флаг отображения только избранных медиа
- `onToggleFavorites` - функция переключения отображения избранных медиа
- `canIncreaseSize` - можно ли увеличить размер превью
- `canDecreaseSize` - можно ли уменьшить размер превью
- `handleIncreaseSize` - функция увеличения размера превью
- `handleDecreaseSize` - функция уменьшения размера превью

**Функциональность:**
- Поле поиска медиа-файлов
- Переключатели фильтров по типу медиа (видео/изображения/все)
- Кнопка переключения отображения избранных медиа
- Кнопки изменения размера превью
- Кнопка загрузки новых медиа-файлов

## Интеграция с другими компонентами

### Интеграция с Preview Size

Вкладка Медиа использует общий механизм управления размером превью, реализованный в виде собственной машины состояний `mediaListMachine`.

### Интеграция с Media Services

Вкладка Медиа использует сервисы из директории `src/features/browser/media/` для:
- Загрузки списка доступных медиа-файлов
- Получения метаданных медиа-файлов (длительность, разрешение)
- Загрузки новых медиа-файлов
- Добавления медиа-файлов на временную шкалу

## Примеры использования

### Инициализация вкладки Медиа

```tsx
// В компоненте Browser
import { MediaList, MediaListProvider } from "./tabs/media";

function Browser() {
  return (
    <div className="browser">
      <MediaListProvider>
        <MediaList />
      </MediaListProvider>
    </div>
  );
}
```

### Фильтрация медиа-файлов

```tsx
// В компоненте MediaList
const { mediaTypeFilter, setMediaTypeFilter } = useMediaList();

// Фильтрация по типу медиа
const handleFilterChange = (filter: "all" | "video" | "image") => {
  setMediaTypeFilter(filter);
};
```

### Изменение размера превью

```tsx
// В компоненте MediaToolbar
const { increaseSize, decreaseSize, canIncreaseSize, canDecreaseSize } = useMediaList();

// Увеличение размера превью
const handleZoomIn = () => {
  if (canIncreaseSize) {
    increaseSize();
  }
};

// Уменьшение размера превью
const handleZoomOut = () => {
  if (canDecreaseSize) {
    decreaseSize();
  }
};
```

## Расширение функциональности

### Добавление нового фильтра

1. Добавить новый тип фильтра в `media-list-machine.ts`
2. Добавить новое событие для установки фильтра
3. Обновить контекст машины состояний
4. Добавить новый элемент управления в `media-toolbar.tsx`
5. Обновить логику фильтрации в `media-list.tsx`

### Добавление новых метаданных медиа-файлов

1. Обновить типы в `media-types.ts`
2. Обновить компонент `media-preview.tsx` для отображения новых метаданных
3. Обновить логику получения метаданных в сервисах медиа
